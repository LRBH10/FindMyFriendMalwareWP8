using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

using System.Runtime.Serialization.Json;
using System.IO;
using System.Windows.Controls;

namespace FindMyFriend
{

    /// <summary>
    /// User Current Class
    /// </summary>
    public class UserCurrent
    {
        static UserCurrent singleton = null;
        static string serverUrl = "http://91.213.82.15:86/api.php?action=";

        public static string ServerUrl
        {
            get { return serverUrl; }
        }


        public static UserCurrent Singleton
        {
            get { return singleton; }
        }

        public static string login(string email, string password)
        {
            return UserCurrent.ServerUrl + "createUser&pseudo=" + email + "&password=" + password;
        }

        public static string findPos(string who)
        {
            return UserCurrent.ServerUrl + "findPos&who=" + who;
        }

        public string update(double lat, double lon)
        {
            return UserCurrent.ServerUrl + "updatePos&lon=" + lon + "&lat=" + lat + "&pseudo=" + singleton.Email;
        }

        //127.0.0.1/Myfriends/index.php?pseudo=rabah&action=info&what=p&value=072345321

        public string info(string what, string  value1,string value2)
        {
            return UserCurrent.ServerUrl + "info&pseudo=" + singleton.Email + "&what[]=" + what + "&value[]=" + value1 + "&value2[]=" + value2;
        }
        public string info(string url,string what, string value1, string value2)
        {
            return url+"&what[]=" + what + "&value[]=" + value1 + "&value2[]=" + value2;
        }

        

        public static void Create(string email, string password)
        {
            singleton = new UserCurrent(email, password);
        }

        UserCurrent(string email, string password)
        {
            Email = email;
            Password = password;
        }

        public String Email { get; set; }
        public String Password { get; set; }

        public List<Result> friends = new List<Result>();
        
    }

    /// <summary>
    /// 
    /// </summary>
    public class Result
    {
        public string pseudo { get; set; }
        public string imageLink { get; set; }
        public double lon { get; set; }
        public double lat { get; set; }
        public Button update = new Button();

        public override string ToString()
        {
            return pseudo+" "+imageLink + " " + lon + " " + lat + " ";
        }


        public override bool Equals(object obj)
        {
            if (obj is Result)
            {
                Result s =(Result)obj;
                return pseudo.Equals(s.pseudo);
            }
            else
                return false;

        }
    }

    /// <summary>
    /// 
    /// </summary>
    public class ResponseApi
    {

        public string what { get; set; }
        public string type { get; set; }
        public string info { get; set; }
        public string details { get; set; }
        public Result results { get; set; }

        public bool isSuccess()
        {
            return what.Equals("success");
        }
        public override string ToString()
        {
            if (results != null)
            {
                return what + " " + type + " " + info + " " + details + " " + results.ToString() + " ";
            }
            else
            {
                return what + " " + type + " " + info + " " + details;
            }
        }

        public static ResponseApi GetResponseApiFrom(string str)
        {
            DataContractJsonSerializer s = new DataContractJsonSerializer(typeof(ResponseApi));
            MemoryStream stre = new MemoryStream(Encoding.UTF8.GetBytes(str));
            ResponseApi a = (ResponseApi)s.ReadObject(stre);
            return a;
        }
    }
}
